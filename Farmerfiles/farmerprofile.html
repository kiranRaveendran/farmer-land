<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CustomerDashboardtemplate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="Style/navbar.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
   <style>
      body {
        background: linear-gradient(135deg, #cfd8d7, #8fa49e);
        height: 100vh;
   
      }
      .profile-card {
        width: 100%;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 2rem;
      }
      .profile-header {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        border-bottom: 2px solid #eee;
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
      }
      .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        background: url('https://cdn-icons-png.flaticon.com/512/149/149071.png')
          center/cover no-repeat;
      }
      .profile-info h4 {
        margin: 0;
        font-weight: 600;
      }
      .profile-info small {
        color: gray;
      }
      .edit-btn {
        float: right;
      }
    </style>
</head>


<body data-page="profile">
    <!-- sidebar -->
    <div id="sidebar-placeholder"></div>

    <div class="main-content vh-100">
        <!------------------------ topbar----------------------------- -->
        <div id="topbar-placeholder" class="p-3"></div>
        <div class="content-body p-4">
            <!-- Your all content goes here content goes here -->
    <div class="profile-card">
      <div class="profile-header d-flex flex-column flex-sm-row">
        <div class="profile-avatar"></div>
        <div class="profile-info">
          <h4 id="userName">Demo Name</h4>
          <small id="userEmail">demo@gmail.com</small><br />
          <span class="badge bg-success" id="userRole">Customer</span>
        </div>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="text-success mb-0">Personal Information</h5>
        <button id="editBtn" class="btn btn-outline-success btn-sm">
          <i class="fa-solid fa-pen"></i> Edit
        </button>
      </div>

      <div id="infoArea">
        <p><b>First Name:</b> <span id="fname"></span></p>
        <p><b>Last Name:</b> <span id="lname"></span></p>
        <p><b>Date of Birth:</b> <span id="dob"></span></p>
      </div>

      <div id="editArea"></div>
    </div>

        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="Script/loadnavbar.js"></script>
    <script>
      // Load data from localStorage
      let currentUserArray = JSON.parse(localStorage.getItem("currentUser")) || [];
      let allUsers = JSON.parse(localStorage.getItem("isauser")) || [];
      let currentUser = currentUserArray[0];

      const userName = document.getElementById("userName");
      const userEmail = document.getElementById("userEmail");
      const userRole = document.getElementById("userRole");
      const fname = document.getElementById("fname");
      const lname = document.getElementById("lname");
      const dob = document.getElementById("dob");
      const infoArea = document.getElementById("infoArea");
      const editArea = document.getElementById("editArea");
      const editBtn = document.getElementById("editBtn");

      // If no user found (direct access), redirect to login
      if (!currentUser) {
        alert("Please log in first.");
        window.location.href = "../loginForm.html";
      }

      // Show user info
      function displayUser() {
        userName.textContent = currentUser.name || "No Name";
        userEmail.textContent = currentUser.mail;
        userRole.textContent = currentUser.userType || "User";

        // Split name into parts
        let parts = (currentUser.name || "").split(" ");
        fname.textContent = parts[0] || "";
        lname.textContent = parts.slice(1).join(" ") || "";
        dob.textContent = currentUser.dob || "Not added yet";
      }

      displayUser();

      // Handle Edit Button
      editBtn.addEventListener("click", (e) => {
        e.preventDefault();
        editArea.innerHTML = `
        <form id="editForm" class="mt-3">
          <div class="mb-2">
            <label class="form-label">First Name</label>
            <input type="text" class="form-control" id="firstInput" value="${fname.textContent}">
          </div>
          <div class="mb-2">
            <label class="form-label">Last Name</label>
            <input type="text" class="form-control" id="lastInput" value="${lname.textContent}">
          </div>
          <div class="mb-2">
            <label class="form-label">Date of Birth</label>
            <input type="date" class="form-control" id="dobInput" value="">
          </div>
          <button type="submit" class="btn btn-success w-100 mt-2">Save Changes</button>
        </form>`;

        const form = document.getElementById("editForm");
        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const newFirst = document.getElementById("firstInput").value.trim();
          const newLast = document.getElementById("lastInput").value.trim();
          const newDob = document.getElementById("dobInput").value.trim();

          // Update name and dob
          currentUser.name = newFirst + (newLast ? " " + newLast : "");
          currentUser.dob = newDob || currentUser.dob;

          // Update in allUsers array too
          const index = allUsers.findIndex(
            (user) =>
              user.mail === currentUser.mail && user.userType === currentUser.userType
          );
          if (index !== -1) allUsers[index] = currentUser;

          // Save to localStorage
          localStorage.setItem("currentUser", JSON.stringify([currentUser]));
          localStorage.setItem("isauser", JSON.stringify(allUsers));

          displayUser();
          editArea.innerHTML = "";
        });
      });
      
    </script>
    <script src="Script/logout.js"></script>
</body>

</html>